@model CabBookingSystem.Models.Booking

<div class="container mt-5 text-center">
    <h2>Waiting for Driver Confirmation</h2>
    <p>Your booking is being processed. Please wait until the driver accepts the booking.</p>
    <p><strong>Pickup Location:</strong> @Model.PickupLocation</p>
    <p><strong>Drop Location:</strong> @Model.DropLocation</p>
    <p><strong>Distance:</strong> @Model.Distance km</p>
    <p><strong>Total Price:</strong> @Model.Price INR</p>

    <!-- Spinner or loading indicator -->
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>

    <!-- Booking status message -->
    <div id="statusMessage" class="mt-4"></div>
</div>

@section Scripts {
    <script>
        // Polling the server to check for status updates
        function checkBookingStatus() {
            $.getJSON('@Url.Action("CheckBookingStatus", "Booking", new { bookingId = Model.BookingId })', function (data) {
                if (data.status === "Confirmed") {
                    // Redirect to confirmation page
                    window.location.href = '@Url.Action("BookingConfirmation", "Booking", new { bookingId = Model.BookingId })';
                } else if (data.status === "Rejected") {
                    $('#statusMessage').html('<div class="alert alert-danger">Your booking was rejected by the driver.</div>');
                } else {
                    $('#statusMessage').html('<p>Status: <strong>' + data.status + '</strong></p>');
                }
            });
        }

        // Poll every 5 seconds
        setInterval(checkBookingStatus, 5000);
    </script>
}
